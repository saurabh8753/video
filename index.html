<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Z-Tera Player</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body{
  margin:0;
  padding:20px;
  background:#0f172a;
  font-family:system-ui;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.main-card{
  width:100%;
  max-width:1000px;
  background:#1e293b;
  border-radius:16px;
  overflow:hidden;
}

video{width:100%;background:#000}
.content{padding:20px}
#error{padding:40px;text-align:center;color:#f87171}
#ad{margin:20px 0}
</style>
</head>

<body>

<div class="main-card" id="app">
  <div style="padding:100px;text-align:center">
    <i class="fas fa-spinner fa-spin"></i> Loading Video...
  </div>
</div>

<div id="ad"></div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
function timeoutFetch(url,ms=8000){
  return Promise.race([
    fetch(url),
    new Promise((_,reject)=>setTimeout(()=>reject("timeout"),ms))
  ]);
}

async function loadVideo(){
  try{
    const app=document.getElementById("app");
    const videoUrl=new URLSearchParams(location.search).get("url");

    if(!videoUrl) throw "Missing URL";

    const api=`https://ztera.yaartunah.workers.dev/?url=${encodeURIComponent(videoUrl)}`;

    const res=await timeoutFetch(api);
    if(!res.ok) throw "API blocked";

    const data=await res.json();
    if(data.status!=="success") throw "API error";

    const file=data.list[0];
    const stream=file.fast_stream_url?.["480p"] || file.stream_url;

    app.innerHTML=`
    <video id="video" controls playsinline poster="${file.thumbnail}"></video>
    <div class="content">
      <b>${file.name}</b><br><br>
      Size: ${file.size_formatted}<br>
      Duration: ${file.duration}
    </div>
    `;

    const video=document.getElementById("video");

    if(video.canPlayType("application/vnd.apple.mpegurl")){
      video.src=stream;
    }else if(Hls.isSupported()){
      const hls=new Hls();
      hls.loadSource(stream);
      hls.attachMedia(video);
    }

  }catch(err){
    document.getElementById("app").innerHTML=`
      <div id="error">
        ‚ùå Video load failed<br><br>
        Reason: ${err}
      </div>`;
  }
}

loadVideo();


// Ads load after everything safe
window.onload=()=>{
  setTimeout(()=>{
    document.getElementById("ad").innerHTML=`
    <script async data-cfasync="false" src="https://yawncollaremotion.com/900480f9b5ddbf7c34e9918ef9b9770e/invoke.js"><\/script>
    <div id="container-900480f9b5ddbf7c34e9918ef9b9770e"></div>
    `;
  },2000);
};
</script>

</body>
</html>
